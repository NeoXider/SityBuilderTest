# Project Overview

## Ограничения и обязательный стек

- **Unity:** Unity 6  
- **Архитектура:** Clean Architecture, слои разделены по папкам/сборкам.  
  Рекомендуемая структура проектов (каждый слой — свой Assembly Definition):  

```
Assets/
├─ Domain/          # Чистые модели
├─ Application/     # Use cases, бизнес‑логика / сервисы
├─ Presentation/    # UI Toolkit: View / Presenter
└─ Infrastructure/  # Input System, DI, MessagePipe, адаптеры
```

- **UI:** UI Toolkit (декларативная верстка).  
- **DI:** VContainer.  
- **События/шина:** MessagePipe.  
- **Реактивщина:** UniRx (R3).  
- **Async:** UniTask.  
- **Ввод:** Input System.  
- **Инспектор:** TriInspector (где уместно, для удобства настройки).  
- **Без ECS:** использовать обычные MonoBehaviour/ScriptableObject.

**Кодстайл проекта**  
...

---

## Функциональные требования

1. **Карта и сетка**
   - Плоская сцена с клеточной сеткой (например, 32×32).  
   - Визуальная подсветка клетки под курсором: зелёная — можно ставить; красная — нельзя.

2. **Каталог зданий**  
| Тип здания | Стоимость | Уровни улучшения | Эффекты |
|------------|-----------|------------------|---------|
| Дом        | 100 Gold  | Lv1 → Lv2, Lv3   | +1 житель / мин |
| Ферма      | 200 Gold  | Lv1 → Lv2         | +5 Gold / мин |
| Шахта      | 150 Gold  | Lv1 → Lv2         | +10 Gold / мин |

3. **Установка / Перемещение / Удаление**
   - **Установка:** клик по допустимой клетке.  
   - **Перемещение:** выбрать здание → режим перемещения → поставить на новую клетку (проверка занятости).  
   - **Удаление:** через контекстное действие (кнопка в UI).  
   - Все операции идут через Use Case (Application‑слой), не напрямую из View.

4. **Улучшение зданий**
   - Минимум 2 уровня улучшений.  
   - Проверка ресурсов/стоимости; при нехватке — отказ с UI‑подсказкой.

5. **Ресурсы и доход**
   - Валюта Gold.  
   - Пассивный доход от зданий раз в N секунд (или каждый тик) – реализовать без лишних аллокаций (`UniTask` + `R3` таймеры/стримы).

6. **Камера и ввод**
   - WASD / правый клик/drag — перемещение камеры; колесо — зум (Input System).  
   - Горячие клавиши: 1/2/3 — выбор префаба здания; `R` — вращать; `Del` — удалить.

7. **Сохранение/загрузка**
   - Состояние (позиции, типы, уровни) в JSON (PlayerPrefs или файл).  
   - Автосейв раз в X секунд (`UniTask`), кнопка «Сохранить / Загрузить» в UI.

8. **UI Toolkit**
   - Панель выбора зданий (иконки/кнопки).  
   - Панель ресурсов и уведомлений.  
   - Панель свойств выбранного здания (уровень, кнопка Upgrade/Move/Delete).

9. **События**
   - Коммуникация между слоями через MessagePipe (события «Здание построено», «Удалено», «Улучшено», «Недостаточно золота», «Сохранено / Загружено» и т.п.).  
   - UseCase вызывается при помощи сообщений DTO.

---

> **Важно:** Все бизнес‑операции вынесены в слой `Application`. View отвечает только за отображение, а Presenter обрабатывает пользовательские события и публикует DTO в MessagePipe.  

**Рекомендации по реализации**

- Использовать `IEntity`/`IBuildingModel` интерфейсы для зданий.  
- Хранить состояние на уровне `Domain`.  
- Для таймеров использовать `UniTask.Delay(TimeSpan)` в сочетании с `R3.Timer`.
